<!DOCTYPE html>
<html>
<head>
    <title>CryptoSnark Trader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CryptoSnark Trader</h1>
        <p id="balance">üí∞ –ë–∞–ª–∞–Ω—Å: –ó–∞–≥—Ä—É–∑–∫–∞...</p>
        <p id="tnd">ü™ô TND: –ó–∞–≥—Ä—É–∑–∫–∞...</p>
        <button onclick="buyTND()">–ö—É–ø–∏—Ç—å TND</button>
        <button onclick="sellTND()">–ü—Ä–æ–¥–∞—Ç—å TND</button>
        <h2>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</h2>
        <p id="referralLink">üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: –ó–∞–≥—Ä—É–∑–∫–∞...</p>
        <p id="referrals">üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ: –ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Web App
        Telegram.WebApp.ready();

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞
        async function loadPlayerData() {
            const user = Telegram.WebApp.initDataUnsafe.user;
            if (!user) {
                alert("–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.");
                return;
            }

            const response = await fetch(`/get_player_data?user_id=${user.id}`);
            const data = await response.json();

            document.getElementById("balance").textContent = `üí∞ –ë–∞–ª–∞–Ω—Å: ${data.balance} –®–∏–∫–æ–∏–Ω–æ–≤`;
            document.getElementById("tnd").textContent = `ü™ô TND: ${data.portfolio.TND || 0}`;
            document.getElementById("referralLink").textContent = `üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: https://t.me/–≤–∞—à_–±–æ—Ç?start=${data.referral_code}`;
            document.getElementById("referrals").textContent = `üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ: ${data.referrals || 0}`;
        }

        // –ü–æ–∫—É–ø–∫–∞ TND
        async function buyTND() {
            const user = Telegram.WebApp.initDataUnsafe.user;
            const response = await fetch(`/buy_tnd?user_id=${user.id}`);
            const result = await response.json();
            alert(result.message);
            loadPlayerData();  // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        }

        // –ü—Ä–æ–¥–∞–∂–∞ TND
        async function sellTND() {
            const user = Telegram.WebApp.initDataUnsafe.user;
            const response = await fetch(`/sell_tnd?user_id=${user.id}`);
            const result = await response.json();
            alert(result.message);
            loadPlayerData();  // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        loadPlayerData();
    </script>
</body>
</html>